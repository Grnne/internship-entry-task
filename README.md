# TicTacToe REST API

## Описание 
REST API для игры в крестики нолики с вариативным размером поля и длиной победной серии, каждый третий ход с шансом в 10% может быть поставлен значок противоположного игрока.
В будущем, возможно, сделаю реализацию авторизации и мультиплеера, сейчас работает как hot seat режим, пользователь посылает id игроков для выбора игроков.

## Запуск
Требуется .NET SDK 9 и Docker
Склонируйте проект
Перейдите в корень проекта и сделайте `docker-compose up -d`
Перейдите на https://localhost:8081 или http://localhost:8080
Вас перекинет на https://localhost:8081/swagger/index.html с документацией и возможностью потыкать АПИ.

Так же можно локально запускать проект если запущена база данных с данными как в ConnectionStrings

Для тестов: в корне проекта dotnet test TicTacToe.sln
	    dotnet test TicTacToe.sln --collect:"XPlat Code Coverage" -- создаст файл с показателями покрытия и т.д.

## Подробное описание
Архитектура немного урезанная N-tier(слоистая). 
Используемые инструменты и технологии:
- **Платформа:** .NET 9 с ASP.NET Core Web API  
- **ORM:** Entity Framework Core с провайдером Npgsql для работы с PostgreSQL  
- **База данных:** PostgreSQL 
- **Конфигурация:** DotNetEnv(хз зачем, попробовал, теперь не хочется удалять) и стандартные переменные среды
- **Документация API:** Swagger/OpenAPI (Swashbuckle)  
- **Тестирование:** xUnit с Coverlet для unit и интеграционных тестов и подсчёта покрытия кода  

В соответствии с ТЗ сделано:
- **Создание игры** с настройками поля и длиной линии победы через запрос и переменные окружения.
- **Ходы двух игроков** с проверкой очередности и валидности.
- **Специальное правило:** каждый третий ход с вероятностью 10% ставится значок соперника.
- **Фиксация победы и ничьей** реализована и хранится в базе.
- **Идемпотентность и concurrency:** повторные одинаковые запросы ходов возвращают `200 OK` и тот же `ETag`.
- **Crash-safe persistence:** состояние игры сохраняется в PostgreSQL и восстанавливается после перезапуска контейнера.
- **Обработка ошибок:** некорректный JSON возвращает `400 Bad Request` с описанием в формате RFC 7807.
- **Docker:** проект собирается и запускается через `docker-compose`, слушает порт 8080.
- **Тесты:** есть unit и интеграционные тесты с покрытием >30%
- **Документация:** Swagger UI доступен по `/swagger`.

Ещё хочется сделать авторизацию и signalR оповещения для мультиплеера и возможно мидллеваре с логгингом\ошибками централизованный

# Описание API 

## Краткое описание контроллеров

### GameController
Отвечает за основные операции с игрой:

- **POST /api/game** — создание новой игры с параметрами поля и победы. Возвращает детали созданной игры или ошибку.
- **GET /api/game/{gameId}** — получение информации о конкретной игре по идентификатору.
- **DELETE /api/game/{gameId}** — удаление игры по идентификатору.

Все ошибки возвращаются с помощью структурированных `ProblemDetails`, предусмотрена валидация и корректные HTTP-коды.

---

### MoveController
Обрабатывает ход игрока:

- **POST /api/move** — делает ход в игре. Поддерживается идемпотентность ходов: повторный одинаковый запрос возвращает `200 OK` с ETag в заголовках, новый ход — `201 Created` с текущим состоянием игры.
- При ошибках возвращает `400 Bad Request` с описанием ошибки.

Контроллер обеспечивает корректную обработку запросов на ход, включая специальные правила игры, и передачу соответствующих HTTP статусов.
